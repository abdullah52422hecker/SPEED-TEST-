<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Speed Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for the application */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- Gauge Styles --- */
        .gauge-container {
            width: 300px;
            height: 150px;
            position: relative;
            overflow: hidden;
        }

        .gauge-bg {
            width: 100%;
            height: 100%;
            border-radius: 150px 150px 0 0;
            border: 20px solid #1f2937; /* gray-800 */
            box-sizing: border-box;
            position: absolute;
            z-index: 1;
        }

        .gauge-fill {
            width: 100%;
            height: 100%;
            border-radius: 150px 150px 0 0;
            border: 20px solid transparent;
            box-sizing: border-box;
            position: absolute;
            z-index: 2;
            transform: rotate(0deg);
            transition: transform 0.5s ease-out;
            border-top-color: #3b82f6; /* blue-500 */
            border-right-color: #3b82f6;
        }

        .gauge-needle {
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 2px;
            height: 130px;
            background-color: #f87171; /* red-400 */
            transform-origin: bottom center;
            transform: translateX(-50%) rotate(0deg);
            transition: transform 0.8s cubic-bezier(0.23, 1, 0.32, 1);
            z-index: 4;
            border-radius: 2px;
        }

        .gauge-center-cap {
            position: absolute;
            bottom: -10px;
            left: 50%;
            width: 20px;
            height: 20px;
            background-color: #f87171; /* red-400 */
            border-radius: 50%;
            transform: translateX(-50%);
            z-index: 5;
        }

        /* --- Button Styles --- */
        #start-btn {
            transition: all 0.3s ease;
        }

        #start-btn:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        #start-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* --- Animation for text --- */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- Hide scrollbar --- */
        ::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

    </style>
</head>
<body class="bg-gray-900 text-gray-200 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-white tracking-tight">Internet Speed Test</h1>
            <p class="text-gray-400 mt-2">Measure your connection speed accurately.</p>
        </header>

        <main>
            <!-- Speed Gauge and Start Button -->
            <div class="relative flex flex-col items-center justify-center mb-8">
                <div class="gauge-container mb-4">
                    <div class="gauge-bg"></div>
                    <div id="gauge-fill" class="gauge-fill"></div>
                    <div id="gauge-needle" class="gauge-needle"></div>
                    <div class="gauge-center-cap"></div>
                </div>
                <div class="absolute top-full -mt-10 text-center">
                    <span id="speed-display" class="text-5xl font-bold text-white">0.00</span>
                    <span id="unit-display" class="text-lg text-gray-400 block">Mbps</span>
                </div>
                <button id="start-btn" class="mt-20 px-8 py-4 bg-blue-600 text-white text-2xl font-semibold rounded-full shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-800">
                    GO
                </button>
            </div>

            <!-- Results Display -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center mb-8">
                <!-- PING -->
                <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                    <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Ping</h3>
                    <p id="ping-result" class="text-3xl font-semibold text-white">-</p>
                    <p class="text-gray-500">ms</p>
                </div>
                <!-- JITTER -->
                <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                    <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Jitter</h3>
                    <p id="jitter-result" class="text-3xl font-semibold text-white">-</p>
                    <p class="text-gray-500">ms</p>
                </div>
                <!-- DOWNLOAD -->
                <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                    <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Download</h3>
                    <p id="download-result" class="text-3xl font-semibold text-white">-</p>
                    <p class="text-gray-500">Mbps</p>
                </div>
                <!-- UPLOAD -->
                <div class="bg-gray-800 p-4 rounded-lg shadow-md">
                    <h3 class="text-sm font-medium text-gray-400 uppercase tracking-wider">Upload</h3>
                    <p id="upload-result" class="text-3xl font-semibold text-white">-</p>
                    <p class="text-gray-500">Mbps</p>
                </div>
            </div>

            <!-- User Information -->
            <footer class="text-center text-sm text-gray-500 border-t border-gray-700 pt-4">
                <p>Your IP Address: <span id="ip-address">-</span></p>
                <p class="mt-2">Powered by modern web technologies.</p>
            </footer>

        </main>
    </div>

    <script>
        // --- DOM Element References ---
        const startBtn = document.getElementById('start-btn');
        const speedDisplay = document.getElementById('speed-display');
        const unitDisplay = document.getElementById('unit-display');
        const gaugeNeedle = document.getElementById('gauge-needle');
        const gaugeFill = document.getElementById('gauge-fill');

        const pingResultEl = document.getElementById('ping-result');
        const jitterResultEl = document.getElementById('jitter-result');
        const downloadResultEl = document.getElementById('download-result');
        const uploadResultEl = document.getElementById('upload-result');
        const ipAddressEl = document.getElementById('ip-address');

        // --- Configuration ---
        // Using a publicly available large file for testing. Cache is bypassed by adding a timestamp.
        const downloadTestFile = 'https://images.unsplash.com/photo-1461988320302-91bde64fc8e4';
        const downloadFileSize = 5242880; // Approx 5.2 MB in bytes.
        const uploadTestSize = 2 * 1024 * 1024; // 2 MB
        const pingTestCount = 5;

        let testState = {
            ping: 0,
            jitter: 0,
            downloadSpeed: 0,
            uploadSpeed: 0,
            isTesting: false,
        };

        // --- UI Update Functions ---

        function updateGauge(speed) {
            // Speed mapping: 0-1 Mbps -> 0-18 deg, 1-10 -> 18-72, 10-100 -> 72-144, 100+ -> 144-180
            let rotation = 0;
            if (speed > 100) {
                rotation = 144 + (Math.min(speed, 1000) - 100) * (36 / 900);
            } else if (speed > 10) {
                rotation = 72 + (speed - 10) * (72 / 90);
            } else if (speed > 1) {
                rotation = 18 + (speed - 1) * (54 / 9);
            } else {
                rotation = speed * 18;
            }
            gaugeNeedle.style.transform = `translateX(-50%) rotate(${rotation}deg)`;
            gaugeFill.style.transform = `rotate(${rotation}deg)`;
        }

        function updateSpeedDisplay(speed) {
            speedDisplay.textContent = speed.toFixed(2);
            updateGauge(speed);
        }
        
        function resetUI() {
            updateSpeedDisplay(0);
            ['ping-result', 'jitter-result', 'download-result', 'upload-result'].forEach(id => {
                document.getElementById(id).textContent = '-';
                document.getElementById(id).classList.remove('fade-in');
            });
            startBtn.disabled = false;
            startBtn.textContent = 'GO';
            unitDisplay.textContent = 'Mbps';
        }

        function displayFinalResult(element, value) {
            element.textContent = value;
            element.classList.add('fade-in');
        }

        // --- Speed Test Logic ---
        
        // 1. PING & JITTER TEST
        async function testPing() {
            unitDisplay.textContent = 'ms';
            const latencies = [];
            for (let i = 0; i < pingTestCount + 1; i++) {
                const startTime = performance.now();
                try {
                    // Fetch a small resource to measure latency, bypassing cache
                    await fetch('/favicon.ico?t=' + new Date().getTime(), { mode: 'no-cors', cache: 'no-store'});
                } catch (e) {
                    // no-cors will throw error, which is expected.
                }
                const endTime = performance.now();
                const latency = endTime - startTime;
                if (i > 0) { // Discard first measurement (can be slow due to DNS lookup etc.)
                    latencies.push(latency);
                    updateSpeedDisplay(latency);
                }
                await new Promise(resolve => setTimeout(resolve, 200));
            }

            const sumLatency = latencies.reduce((a, b) => a + b, 0);
            testState.ping = Math.round(sumLatency / latencies.length);
            
            let jitterSum = 0;
            for (let i = 1; i < latencies.length; i++) {
                jitterSum += Math.abs(latencies[i] - latencies[i-1]);
            }
            testState.jitter = Math.round(jitterSum / (latencies.length - 1));

            displayFinalResult(pingResultEl, testState.ping);
            displayFinalResult(jitterResultEl, testState.jitter);
        }

        // 2. DOWNLOAD TEST
        function testDownload() {
            return new Promise((resolve) => {
                unitDisplay.textContent = 'Mbps';
                const xhr = new XMLHttpRequest();
                let lastLoaded = 0;
                let lastTime = performance.now();

                xhr.open('GET', `${downloadTestFile}?t=${new Date().getTime()}`, true);
                
                xhr.onprogress = function(event) {
                    const currentTime = performance.now();
                    const loaded = event.loaded;
                    
                    const timeDiff = (currentTime - lastTime) / 1000; // in seconds
                    const bytesDiff = loaded - lastLoaded;
                    const speedBps = (bytesDiff * 8) / timeDiff; // bits per second
                    const speedMbps = speedBps / 1000000;

                    if (isFinite(speedMbps)) {
                        updateSpeedDisplay(speedMbps);
                    }

                    lastLoaded = loaded;
                    lastTime = currentTime;
                };

                xhr.onloadend = function() {
                    const totalTime = (performance.now() - xhr.startTime) / 1000;
                    const finalSpeedBps = (downloadFileSize * 8) / totalTime;
                    const finalSpeedMbps = finalSpeedBps / 1000000;
                    
                    testState.downloadSpeed = finalSpeedMbps.toFixed(2);
                    displayFinalResult(downloadResultEl, testState.downloadSpeed);
                    resolve();
                };

                xhr.startTime = performance.now();
                xhr.send();
            });
        }

        // 3. UPLOAD TEST (Simulated)
        function testUpload() {
            // A true upload test requires a server. We'll simulate it for this front-end only demo.
            return new Promise((resolve) => {
                unitDisplay.textContent = 'Mbps';
                let startTime = performance.now();
                let progress = 0;

                const simulateProgress = () => {
                    progress += Math.random() * 0.15; // Random increment
                    if (progress > 1) progress = 1;

                    const elapsedTime = (performance.now() - startTime) / 1000;
                    const uploadedBytes = uploadTestSize * progress;
                    const speedBps = (uploadedBytes * 8) / elapsedTime;
                    const speedMbps = speedBps / 1000000;

                    if (isFinite(speedMbps)) {
                        updateSpeedDisplay(speedMbps);
                    }
                    
                    if (progress < 1) {
                        setTimeout(simulateProgress, 100 + Math.random() * 100);
                    } else {
                        const totalTime = (performance.now() - startTime) / 1000;
                        const finalSpeedBps = (uploadTestSize * 8) / totalTime;
                        const finalSpeedMbps = finalSpeedBps / 1000000;

                        testState.uploadSpeed = finalSpeedMbps.toFixed(2);
                        displayFinalResult(uploadResultEl, testState.uploadSpeed);
                        resolve();
                    }
                };
                
                setTimeout(simulateProgress, 100);
            });
        }
        
        // --- Main Controller ---
        async function startTest() {
            if (testState.isTesting) return;
            
            testState.isTesting = true;
            resetUI();
            startBtn.disabled = true;
            startBtn.textContent = 'Testing...';

            await testPing();
            await testDownload();
            await testUpload();

            // Test finished
            startBtn.textContent = 'Test Again';
            startBtn.disabled = false;
            testState.isTesting = false;
            updateSpeedDisplay(0); // Reset gauge after test
            unitDisplay.textContent = 'Mbps';
        }

        // --- Initial Load ---
        function getIpAddress() {
             fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    ipAddressEl.textContent = data.ip;
                })
                .catch(error => {
                    console.error("Could not fetch IP address:", error);
                    ipAddressEl.textContent = "Unavailable";
                });
        }
        
        window.onload = () => {
            resetUI();
            getIpAddress();
            startBtn.addEventListener('click', startTest);
        };
    </script>
</body>
</html>

  
